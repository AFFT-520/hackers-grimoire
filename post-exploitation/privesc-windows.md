# Privilege escalation: Windows

If you started hacking on Linux, Windows can be frustrating and weird. But that's what most networks are running, from desktops to domain controllers. So you just have to get used to it.

## Gathering system information

These commands can be issued remotely using a cmd.exe shell.

Get system information:

```text
systeminfo
```

Check the OS version:

```text
systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
```

Check active network connections:

```text
netstat -ano
```

Check firewall settings:

```text
netsh firewall show state
netsh firewall show config
```

Check scheduled tasks:

```text
schtasks /query /fo LIST /v
```

Check running processes linked to services:

```text
tasklist /SVC
```

Check for running services:

```text
net start
```

Check for installed drivers:

```text
DRIVERQUERY
```

Check for installed patches:

```text
wmic qfe get Caption,Description,HotFixID,InstalledOn
```

Search for files that contain ‘password’ in the filename:

```text
dir /s *password*
```

Search for the keyword ‘password’ in files with the .txt extension:

```text
findstr /si password *.txt
```

## Unquoted service path

This is a common vulnerability for installed programs that don't put quotes around the file path to the executable:

```text
C:\Program Files\Some Software\Software.exe     #unquoted

"C:\Program Files\Some Software\Software.exe"
```

When Windows tries to locate the program, it guesses and tries to execute any word before a space. For example, in the unquoted service path above, Windows will try:

```text
C:\Program.exe

C:\Program Files\Some.exe

C:\Program Files\Some Software\Software.exe
```

An attacker could exploit this behaviour by putting a malicious program earlier in the file path so that Windows executes it before the legitimate one. In order for this to be successful, these conditions must be true:

1. There is a service with an unquoted binary path containing one or more spaces in the path
2. The current user has Write permissions for the folders containing spaces
3. There is a way to reboot the system or service in order to execute a payload

